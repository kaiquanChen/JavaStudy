## Redis持久化

### 1. RDB
- 能够在指定时间间隔对数据进行快照存储

>RDB的优点:
>
    1. RDB在保存RDB文件时,父进程会fork出一个子进程,然后由子进程负责备份,父进程不做任务IO操作,有效提高Redis性能.
    2. 与AOF相比,在恢复大的数据集的时候,RDB效率高
    3. RDB是一个紧凑的文件,便于方便传送到远端数据中心
    
>RDB的缺点:
>
    1. RDB可能会丢失最后一次需要保存的数据,因为还不到指定的数据备份时间,Redis就意外停止工作了.
    2. RDBfork子进程的过程非常耗费性能,可能导致Redis在毫秒级无法响应客户端
    
>工作方式:
>
    1. Redis调用forks,同时拥有父进程和子进程
    2. 子进程将数据集写入到一个临时RDB文件中
    3. 当子进程完成对新RDB文件写入时,Redis用新RDB文件替换原来的RDB文件,并删除旧的RDB文件

### 2. AOF
- 记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以Redis协议追加到文件末尾.Redis还能对AOF进行后台重写操作,使得AOF文件的体积不至于过大

>AOF的优点:
>
    1. Redis可以在AOF体积过大时,自动地在后台对AOF进行重写
    2. AOF文件有序的保存了所有对数据库的写操作,这些写操作以Redis协议的格式保存.
    
>AOF的缺点:
>
    1. 对于相同数据集来说,AOF文件要RDB文件庞大很多
    2. 根据所使用fsync策略,AOF速度可能会慢于RDB(默认fsync每秒一次)
    
>工作方式:
>
    1. Redis执行fork(),现在同时拥有父进程和子进程
    2. 子进程开始将新AOF文件的内容写入到临时文件
    3. 对于所有新执行的写命令,Redis会将他们同时写入内存缓存中和追到到AOF文件中的末尾
    
>ps:
>
    1. Redis会默认使用AOF文件来恢复数据集,AOF文件保存的数据通常是最完整的
    